<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QuÃªte des Stands â€“ Point Animations</title>
<style>
body{
  font-family:Arial,sans-serif;
  background:radial-gradient(circle at top,#2a0033,#0b0010);
  color:white;
  text-align:center;
  padding:20px;
}
.box{
  max-width:420px;
  margin:auto;
  background:rgba(0,0,0,0.65);
  padding:22px;
  border-radius:18px;
  box-shadow:0 0 25px rgba(255,95,210,0.25);
}
h1,h2{
  color:#ff5fd2;
  text-shadow:0 0 8px rgba(255,95,210,0.6);
}
.stand-image{
  width:100%;
  max-width:360px;
  margin:15px auto;
  border-radius:14px;
  box-shadow:0 0 20px rgba(255,95,210,0.35);
}
input{
  width:80%;
  padding:10px;
  margin-top:10px;
  border-radius:20px;
  border:none;
  text-align:center;
}
button{
  margin-top:14px;
  padding:12px 22px;
  background:linear-gradient(135deg,#ff5fd2,#b84dff);
  border:none;
  border-radius:30px;
  font-weight:bold;
  color:black;
  cursor:pointer;
}
button:hover{ transform:scale(1.05); }
.success{ color:#6bffb0; margin-top:12px; }
.error{ color:#ff6b6b; margin-top:12px; }
.mission-complete{
  font-size:28px;
  font-weight:bold;
  color:#6bffb0;
  text-shadow:0 0 8px #6bffb0,0 0 16px #6bffb0,0 0 24px #6bffb0;
  animation:pulse 1.2s infinite alternate;
  margin-top:20px;
}
@keyframes pulse{
  from{transform:scale(1);opacity:0.7;}
  to{transform:scale(1.08);opacity:1;}
}
</style>
</head>
<body>
<div class="box">
<h1 id="title">QuÃªte des Stands</h1>
<div id="content"></div>
</div>
<script>
/* ========================= RESET CACHÃ‰ ========================= */
const title = document.getElementById("title");
let pressTimer;
title.addEventListener("mousedown",startReset);
title.addEventListener("touchstart",startReset);
title.addEventListener("mouseup",cancelReset);
title.addEventListener("mouseleave",cancelReset);
title.addEventListener("touchend",cancelReset);
function startReset(){
  pressTimer=setTimeout(()=>{
    localStorage.removeItem("progress");
    localStorage.removeItem("startTime");
    alert("Progression rÃ©initialisÃ©e");
    location.reload();
  },3000);
}
function cancelReset(){ clearTimeout(pressTimer); }

/* ========================= TIMER MIN 10 MIN ========================= */
const MIN_TIME = 10 * 60 * 1000;
let startTime = localStorage.getItem("startTime");
if(!startTime){
  startTime = Date.now();
  localStorage.setItem("startTime",startTime);
}else{
  startTime = parseInt(startTime);
}

/* ========================= IMAGE ACCUEIL ========================= */
const presentationImage="images/presentation.png";

/* ========================= STANDS ========================= */
const stands=[
{ title:"Point Animations", text:"ðŸŽ¤âœ¨ Joue Ã  la QuÃªte des Stands ! âœ¨ðŸŽ¤\n\nPars explorer les stands et rÃ©ponds Ã  leurs Ã©nigmes." },
{ title:"Stand L135 â€“ KaratÃ© Dojo Marseillais", question:"Combien de ceintures noires le KaratÃ© Dojo Marseillais a eu dans ses rands depuis sa crÃ©ation en 2014 (en chiffres) ?", answers:["45"] },
{ title:"Stand E037 â€“ Game Academy", question:"Quelles sont les formations proposÃ©es Ã  Game Academy ?", answers:["game artist et game developer"] },
{ title:"Stand E182 â€“ Association Animaniak", question:"Quel logiciel utilise l'association Animaniak pour proposer du karaoke ?", answers:["karaoke mugen"] },
{ title:"Stand E198 â€“ Chinafi", question:"Le kanji Â« å¤¢ Â» (yume) correspond Ã  quel mot ?", answers:["rÃªve"] },
{ title:"Stand D038 â€“ Doud dans le retro", question:"De quelle console Ã  quelle console peut-on jouer Ã  Mario Kart sur le stand Doud dans le rÃ©tro ?", answers:["super nintendo Ã  wii"] }, 
{ title:"Stand E190 â€“ Event Yaoi", question:"A quel anime le dojinshi 'Replace' par Ozone prÃ©sent sur notre stand fait-il rÃ©fÃ©rence ?", answers:["kuroko's basket", "kuroko no basket"] },
{ title:"Stand E139 â€“ DT Workshop", question:"Comment s'appelle la mascotte de DT WORKSHOP ?", answers:["bob le boug"] },
{ title:"Stand L172 â€“ Pimp Ton Perso", question:"Quel jeu de rÃ´le est toujours programmÃ© Ã  10h sur le stand Pimp Ton Perso ?", answers:["phasmoboo"] },
{ title:"Stand B030 â€“ Aoi Sora Cosplay", question:"Comment appelle-t-on quelqu'un qui fait du cosplay ?", answers:["cosplayer"] },
{ title:"Stand G027 â€“ Tekken Marseille", question:"Combien de personnages fÃ©minins y a-t-il dans Tekken 8 (en chiffres) ?", answers:["12"] },
{ title:"Stand L160 â€“ Star Hill Team", question:"Qu'est ce qu'un diorama ?", answers:["maquette exposition de figurine"] },
{ title:"Stand J150 â€“ ASSL Provence", question:"Quelle est l'annÃ©e de crÃ©ation de l'ASSL Provence ?", answers:["2016"] }
];

/* ========================= SAUVEGARDE ========================= */
let progress=parseInt(localStorage.getItem("progress"))||0;
let current=progress;
const content=document.getElementById("content");

/* ========================= NORMALISATION ========================= */
function normalize(text){
return text
.toLowerCase()
.normalize("NFD")
.replace(/[\u0300-\u036f]/g,"") // retire accents
.replace(/[^a-z0-9\s]/g,"") // retire ponctuation
.replace(/\s+/g," ") // espaces multiples
.trim();
}
function levenshtein(a, b) {
const matrix = [];
for (let i = 0; i <= b.length; i++) matrix[i] = [i];
for (let j = 0; j <= a.length; j++) matrix[0][j] = j;

for (let i = 1; i <= b.length; i++) {
  for (let j = 1; j <= a.length; j++) {
    if (b[i - 1] === a[j - 1]) {
      matrix[i][j] = matrix[i - 1][j - 1];
    } else {
      matrix[i][j] = Math.min(
        matrix[i - 1][j - 1] + 1,
        matrix[i][j - 1] + 1,
        matrix[i - 1][j] + 1
      );
    }
  }
}
return matrix[b.length][a.length];
}

/* ========================= RENDER ========================= */
function render(){
if(current>=stands.length){
  const elapsed = Date.now() - startTime;
  if(elapsed < MIN_TIME){
    const remaining = Math.ceil((MIN_TIME - elapsed)/60000);
    content.innerHTML = `
<p class="error">
    â›” On ne la fait pas Ã  Chibi Dino, pris la main dans le sac petit tricheur ! ðŸ˜ˆ<br><br>
    Retourne au Point Animations pour recommencer.<br>
</p>
<img src="images/holmes.png" class="stand-image">
`;
    return;
  }
  content.innerHTML=`
<div class="mission-complete">
  MISSION COMPLETE
</div>
<p class="success">
  ðŸŽ‰ Bravo !<br><br>
  PrÃ©sente cet Ã©cran au staff du Point Animations.
</p>`;
  return;
}
const stand=stands[current];
if(!stand.question){
content.innerHTML=`
<h2>${stand.title}</h2>
<img src="${presentationImage}" class="stand-image">
<p>${stand.text.replace(/\n/g,"<br>")}</p>
<button onclick="next()">Commencer</button>`;
return;
}
content.innerHTML=`
<h2>${stand.title}</h2>
<p>${stand.question}</p>
<input id="answer" placeholder="Ta rÃ©ponse">
<br>
<button onclick="check()">Valider</button>
<div id="message"></div>`;
}

/* ========================= CHECK ========================= */

function isNumeric(str){
  return /^[0-9]+$/.test(str);
}

function check(){
const answer=document.getElementById("answer");
const message=document.getElementById("message");
const userRaw=answer.value.trim();
const user=normalize(userRaw);

if(!user){
  message.innerHTML=`<p class="error">Entre une rÃ©ponse ðŸ˜‰</p>`;
  return;
}

const validAnswers=stands[current].answers.map(a=>normalize(a));

// VÃ©rifie si la question attend une rÃ©ponse numÃ©rique
const numericExpected = validAnswers.every(a => isNumeric(a));

let ok=false;

if(numericExpected){
  // COMPARAISON STRICTE (pas de tolÃ©rance)
  ok = validAnswers.includes(userRaw.trim());
}else{
  // MODE TOLÃ‰RANT (comme avant)
  ok = validAnswers.some(a=>{
    if(user === a) return true;
    if(user.includes(a)) return true;
    if(levenshtein(user,a) <= Math.max(1, Math.floor(a.length * 0.3))) return true;
    return false;
  });
}

if(ok){
  progress=current+1;
  localStorage.setItem("progress",progress);
  message.innerHTML=`
<p class="success">Bonne rÃ©ponse !</p>
<button onclick="next()">Continuer âžœ</button>`;
}else{
  message.innerHTML=`<p class="error">Mauvaise rÃ©ponse, observe bien le stand ðŸ‘€</p>`;
}
}

/* ========================= START ========================= */
render();
</script>
</body>

</html>




